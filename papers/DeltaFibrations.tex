% Created 2020-07-20 Mon 17:52
% Intended LaTeX compiler: pdflatex
\documentclass[12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{grffile}
\usepackage{longtable}
\usepackage{wrapfig}
\usepackage{rotating}
\usepackage[normalem]{ulem}
\usepackage{amsmath}
\usepackage{textcomp}
\usepackage{amssymb}
\usepackage{capt-of}
\usepackage{hyperref}
\usepackage{minted}
\usepackage{multicol}
\usepackage{glossaries}
\makeglossaries
\usepackage{\string~"/unicode-sty/unicode"}
\usepackage{newunicodechar}
\newunicodechar{â¨¾}{\, ; \,}
\newunicodechar{â™¯}{\ensuremath{\sharp}}
\newunicodechar{â¨¾}{\ensuremath{\mathop{\fatsemi}}}
\newunicodechar{Ã—}{\ensuremath{\times}}
\usepackage[font=itshape]{quoting}
\usepackage{tcolorbox}
\usepackage[hmargin=25mm,vmargin=25mm]{geometry}
\setlength{\parskip}{1em}
\setlength{\parskip}{1em}
\usepackage{xcolor} % named colours
\usepackage{color}
\definecolor{darkred}{rgb}{0.3, 0.0, 0.0}
\definecolor{darkgreen}{rgb}{0.0, 0.3, 0.1}
\definecolor{darkblue}{rgb}{0.0, 0.1, 0.3}
\definecolor{darkorange}{rgb}{1.0, 0.55, 0.0}
\definecolor{sienna}{rgb}{0.53, 0.18, 0.09}
\hypersetup{colorlinks,linkcolor=darkblue,citecolor=darkblue,urlcolor=darkgreen}
\def\BEGINstep{ \{ }
\def\ENDstep{ \} }
\newcommand{\step}[2][=]{ \\ #1 \;\; & \qquad {\BEGINstep \text{ #2 } \ENDstep} \\ & }
\newenvironment{calc}{\begin{align*} & }{\end{align*}}
\usepackage[citestyle=authoryear-icomp,style=alphabetic,hyperref=true,backref=true,maxcitenames=3,url=true,backend=biber,natbib=true]
           {biblatex}
\addbibresource{References.bib}
\newcounter{mydefn}
\newtcolorbox{definition}[1]{colback=red!5!white,colframe=red!75!black, title= Definition \themydefn: #1}
\AfterEndEnvironment{definition}{\stepcounter{mydefn}}
\newcounter{mythm}
\newtcolorbox{theorem}[1]{colback=red!5!white, title= Theorem \themythm: #1}
\AfterEndEnvironment{theorem}{\stepcounter{mythm}}
\newcounter{myexmpl}
\newtcolorbox{myexample}[1]{colback=red!5!white,colframe=red!75!black,colbacktitle=yellow!50!red,coltitle=red!25!black,title= Example \themyexmpl: #1}
\AfterEndEnvironment{myexample}{\stepcounter{myexmpl}}
\usepackage{tikz-cd}
\BeforeBeginEnvironment{tikzcd}{\begin{center}}
\AfterEndEnvironment{tikzcd}{\end{center}}
\author{Musa Al-hassy and Zinovy Diskin}
\date{\today}
\title{Edit Space Lenses\\\medskip
\large ---\emph{draft}---}
\hypersetup{
 pdfauthor={Musa Al-hassy and Zinovy Diskin},
 pdftitle={Edit Space Lenses},
 pdfkeywords={},
 pdfsubject={},
 pdfcreator={Emacs 28.0.50 (Org mode 9.3.7)},
 pdflang={English}}
\begin{document}

\maketitle

\tcbset{colback=green!10!white}

\newtcolorbox{myexamplebox}[1]{title=#1,
colback=red!5!white, colframe=red!75!black, colbacktitle=yellow!50!red, coltitle=red!25!black, fonttitle=\bfseries,
subtitle style={boxrule=0.4pt, colback=yellow!50!red!25!white}}

\def\labelitemi{$\diamond$}
\def\labelitemii{$\circ$}
\def\labelitemiii{$\star$}

% Level 0                 Level 0
% + Level 1               â‹„ Level 1
%   - Level 2       --->      âˆ˜ Level 2
%     * Level 3                   â‹† Level 3
%

\def\src{\mathsf{src}\,}
\def\tgt{\mathsf{tgt}\,}
\def\put{\mathsf{put}}
\def\get{\mathsf{get}}
\def\Hom{\mathsf{Hom}}
\def\Mor{\mathsf{Mor}\,}
\def\Obj{\mathsf{Obj}\,}
\def\Id{\mathsf{Id}}


\section{Background}
\label{sec:orge8a6819}

In this section, let ğ’œ and â„¬ be categories.
We will use the notation \(\Obj ğ’³, \Hom ğ’³, \src, \tgt, \_{}â¨¾\_{}, \Id\)
to refer to the objects of a category ğ’³, its homsets, the source object
assignment, the target object assignment, the (forward/diagrammatic)
composition operation, and for the identity operations; respectively.

\begin{definition}{Lifting}
Let \(F : \Obj ğ’œ â†’ \Obj â„¬\) be a \emph{function on objects}.
Define a \textbf{lift\footnote{The diagram suggests the name â€˜liftâ€™ since arrows in the bottom category â„¬ are
assigned to arrows in the top category ğ’œ.} for \(F\)} to be a \emph{family \(G_A\) of functions on arrows}, for each object \(A : ğ’œ\):
\[
G_A : \Hom(A, -) â†_ğ’œ \Hom(F\, A, -)
\]
\begin{tikzcd}
   A \rar[blue, "u"{name=Q, below}] \dar[mapsto, "F"] &  {\color{blue} A'} \dar[blue, mapsto, "F"{}]
\\ B \rar["v"{name=P}] & B' \arrow[Rightarrow, "G_A"{right}, from=P, to=Q]
\end{tikzcd}
\end{definition}

This paper adheres to the following \emph{colouring discipline} for diagrams: Items in
hand are coloured black, whereas \emph{derived} elements are coloured in blue.
Intermediary elements, such as those that are output of one transformation
but input to another, will be coloured grey.

\begin{myexample}{Common Liftings}
\begin{itemize}
\item For \(F\) the identity function, the identity function \(Î± â†¦ Î±\) is a lift.

\item For \(ğ’œ = â„¬ = ğ’®â„¯ğ“‰\), the category of sets and functions,
and \(F\) a bijective map on sets, we may take
\(G_A(v) = F â¨¾ v â¨¾ F^{-1}\) where \(Aâ€² = F^{-1}\bigg(\{v(b) \,|\, b âˆˆ F(A) \}\bigg)\).

In general, \(F\) acts as a form of â€˜queryâ€™ on ğ’œ-objects that yields local,
focused, information. Then the lift \(G\) allows us to transport the local
transformation ---e.g., the set comprehension above--- to the global setting.

\item Recall that a functor \(F\) is an \emph{obfibration}
if given any source object \(A : ğ’œ\) and an â„¬-arrow \(u : F\, A â†’ B'\),
there is universal ğ’œ-arrow \(G_A(u) : A â†’ Aâ€²\) with \(F\, (G_A(u)) = u\).

Every opfibration is thus a lift as witnessed by the \(G_A\) arrows.
As such, out notion of lifts generalises the idea of opfibrations
by dropping the universality requirement.
\end{itemize}
\end{myexample}

\begin{definition}{Stable Lifting}
A lifting is \textbf{stable} if it preserves identities.
     \[
        G_A\, \big(\Id_{F\, A}\big) \quad=\quad \Id_{F\, A}
        \label{Stability} \tag{\sc Stability}
     \]
\end{definition}

\begin{definition}{Sectional Lifting}
Let \(F : ğ’œ â†’ â„¬\) be a \emph{functor},
then a lifting for its object mapping is \textbf{sectional} if
\(F\)'s morphism mapping is a post-inverse to each member of the family:
     \[
        F \left(G_A\, Î±\right) \quad=\quad Î±
        \label{Sectional} \tag{\sc Sectional}
     \]
\end{definition}

\begin{definition}{Delta Lens}
A \textbf{delta lens\footnote{This is also known as a \emph{very-well behaved delta lens} that lacks the
PutPut law, which usually does not hold in applications and so we ignore it.}} is a functor that has a stable sectional lifting.

\vspace{1em}
More explicitly, a delta lens is a tuple \((ğ’œ, â„¬, \get\!, \put\!)\)
consisting of two categories ğ’œ and â„¬, along with a functor \(\get : ğ’œ â†’ â„¬\)
that has \(\put\) as its lifting that satisfies both \eqref{Stability}
and \eqref{Sectional}.
\end{definition}

\begin{theorem}{Delta Lenses form a subcategory ``Î´-Lens'' of ğ’ğ’¶ğ“‰}
The identity functor is clearly a delta lens; it remains to show that the
composition of functors that are delta lenses is again a delta lens.  Indeed, if
\(Fâ‚\) and \(Fâ‚‚\) are functors with stable sectional liftings \(Gâ‚\) and \(Gâ‚‚\),
respectively, then \(Fâ‚ â¨¾ Fâ‚‚\) has \(A â†¦ {Gâ‚‚}_A â¨¾ {Gâ‚}_A\) as a stable sectional
lifting: Each property is immediately verified by, in the following diagram,
starting with the given black elements then following the \(Gáµ¢\)'s to obtain the
required blue elements.

\begin{tikzcd}
   A \rar[blue, "u"{name=Q, below}] \dar[mapsto, "F_1"] &  {\color{blue} A'} \dar[blue, mapsto, "F_1"]
\\ B \rar["v"{name=P}, "v"{below, name=P2}, gray]  \dar[mapsto, "F_2"]  & {\color{blue}B'} \arrow[Rightarrow, "{G_1}_A"{right}, from=P, to=Q] \dar[blue, mapsto, "F_2"]
\\ C \rar["w"{name=R}] & C' \arrow[Rightarrow, "{G_2}_A"{right}, from=R, to=P2]
\end{tikzcd}
\end{theorem}

\section{Asymmetric Edit Delta Lenses}
\label{sec:org2ce36bd}

\def\apply{\mathsf{apply}}
\def\control{\mathsf{control}}

\begin{definition}{Edit Space}
An \textbf{edit space} is an (cloven) obfibration\footnote{For computing purposes, existence is most useful when taken
\emph{constructively}: It is not enough for something to merely exist,
but rather a (computable) construction of the thing must be provided
for an existence claim to be reasonable. As such, our opfibrations
are cloven by default.}.
\end{definition}

Formally, an edit space is a tuple \((ğ’œ, â„³, \control, \apply)\)
consisting of:
\begin{enumerate}
\item a category of â€œğ’œctive processesâ€,
\item a category of â€œâ„³otionsâ€, or â€˜â„³echanicsâ€™, ---these delimit the
behaviour
    of processes; â€˜contracts, metamodels, specificationsâ€™
\item a functor \(\control : ğ’œ â†’ â„³\) that indicates how a process is controlled
or behaved,
\item a lifting \(\apply : \Hom_ğ“(A, -) â† \Hom_ğ•„(\control A, -)\)
where we interpret \\
 \(\apply_A (Ï• : \control A â†’ M)\) as â€œthe execution of
the Ï•-update to \(A\)'s permitted behaviourâ€.
\item such that the lifting produces op-Cartesain arrows:
\begin{tcolorbox}
Given any \(v : M â†’ Mâ€²\) and any \(A : \Obj ğ’œ\) with
\(\control\, A = M\), we have that
\[\control (\apply_A v) \quad=\quad v
    \label{Over} \tag{\sc Over} \]
It is \emph{universal} with this property:
For any other ğ’œ-arrow \(u : A â†’ Aâ€²\),
each factorisation of \(\control\, u\) through \(v\) uniquely
determines a factorisation of \(u\) through \(\apply_A v\).
\end{tcolorbox}
\end{enumerate}

\begin{definition}{Edit Space Lens}
Let \(\controlâ‚ : ğ’œ â†’ â„³\) and \(\controlâ‚‚ : â„¬ â†’ ğ’©\) be edit spaces
---with liftings \(\applyâ‚\) and \(\applyâ‚‚\), respectively.
Define an \textbf{edit Î´-lens} to be a functor
\(\get : â„³ â†’ ğ’©\) with a family of \emph{functions}
\(\put_A : \Hom_ğ’œ(A, -) â† \Hom_â„¬\big((\controlâ‚ â¨¾ \get â¨¾ \applyâ‚‚)\,
A, -\big)\)
satisfying \eqref{Stability}, \eqref{EditSectional}, and the  following
commutativity condition; i.e.,
\(\applyâ‚ = \get â¨¾ \applyâ‚‚ â¨¾ \put\).

\[\put â¨¾ \controlâ‚ â¨¾ \get \quad=\quad \controlâ‚‚
        \label{EditSectional} \tag{\sc EditSectional}\]

\def\dg{black}
\def\g#1{{\color{\dg} #1}} % given items
\def\r#1{{\color{blue} #1}} % required items
\def\s{mapsto}
\def\GG#1{ {\color{gray}{#1}} }
\def\G{gray}
\usetikzlibrary{decorations.pathmorphing} % to use squiggly arrows
\usetikzlibrary{arrows.meta}
\def\midtxt#1{ \arrow[dr, phantom, "#1"] } % text to go in the middle of a square
\def\rr{\ar[rr, gray, bend right = -0, mapsto, near start, "\get", line width = 0.05ex]}
\begin{tikzcd}[column sep=huge]
                    & \g M \ar[dd,\dg,""{name=P}] \rr  &     & \GG{N} \ar[dd, \G, ""{name=Q}]
\\ \g A  \ar[dd, blue,""{name=S}]\ar[\dg, \s,ru] &            & \GG{B} \ar[\G, dd,""{name=R}]\ar[\G, \s,ru] &
\\    & \g M' \rr &   & \GG{N'}
\\ \r A'  \ar[\s,blue,ru] &    & \GG{B'} \ar[\s,\G, ru] &
\arrow[dashed, "\hspace{-2em}\get", from=P, to=Q, bend right = -20]
\arrow[Rightarrow, from=Q, to=R]
\arrow[dashed, "\hspace{1em}\put_A", from=R, to=S, bend right = -20]
\arrow[Rightarrow, from=P, to=S]
\end{tikzcd}
\end{definition}

\begin{theorem}{Edit Delta Lenses form a subcategory â€œÎµÎ´-Lensâ€ of Î´-Lens}
Opfibrations are known to form a category; details can be found in \cite{JacobsCLTT}.
\end{theorem}

Now to the main theorem.

Given a functor \(F : ğ’œ â†’ â„¬\), define the category \(ğ’œ / â„¬\) to have objects
the pairs \((A : \Obj ğ’œ, B : \Obj)\) with \(F\, A = B\), and to have arrows
\((A, B) â†’ (Aâ€², Bâ€²)\) to be pairs \((u : A â†’_ğ’œ Aâ€², v : B â†’_â„¬ Bâ€²)\) such that
the resulting square commutes; i.e., \(F\, A = B, F\, Aâ€² = Bâ€²\), and \(F\, u = v\).
Composition and identities are inherited from ğ’œ and â„¬, and the required
conditions are met due to the functoriality of \(F\).

\begin{theorem}{ÎµÎ´-Lenses are Î´-Lenses between certain categories}
More precisely: If \(\get\) is an ÎµÎ´-lens from \(\controlâ‚ : ğ’œ â†’ â„³\) to \(\controlâ‚‚ :
â„¬ â†’ ğ’©\), then \(\get\) induces a Î´-lens from \(ğ’œ/â„³\) to \(â„¬/ğ’©\).
\end{theorem}

\textbf{Proof}.
Define the functor \(\getâ€² : ğ’œ/â„³ âŸ¶ â„¬/â„³\)
and family \(\putâ€²\) by the following equations:
\[
\getâ€²(x, y) \quad=\quad (\applyâ‚‚\, \get\, \controlâ‚\, x,\; \get\, y)
\]
\vspace{-1em}
\[\putâ€²_{A, M}(x, y)
\quad=\quad (\put_A\, x,\; \controlâ‚\, \put_A\, \applyâ‚‚\, y) \]

\noindent
Functoriality of \(\get'\) is inherited from \(\get\).
It remains to show that this has \(\put'\) as a stable sectional lifting.
\begin{itemize}
\item Stability follows from the stability of \(\put_A\).
\item Sectional:
\end{itemize}

\begin{align*} &
\getâ€² (\putâ€² (x, y))
\step{ Definition of $\putâ€²$ }
\getâ€² (\put_A\, x,\; \controlâ‚\, \put_A\, \applyâ‚‚\, y)
\step{ Definition of $\getâ€²$ }
( (\put â¨¾ \controlâ‚ â¨¾ \get â¨¾ \applyâ‚‚)\, x,\;
  (\applyâ‚‚ â¨¾ \put â¨¾ \controlâ‚ â¨¾ \get)\, y)
\step{ \eqref{EditSectional} axiom, twice }
( (\controlâ‚‚ â¨¾ \applyâ‚‚)\, x,\;
  (\applyâ‚‚ â¨¾ \controlâ‚‚)\, y)
\step{ \eqref{Over} laws }
( (\controlâ‚‚ â¨¾ \applyâ‚‚)\, x,\;
  y)
\step{ ??? }
(x, y)
\end{align*}

\addcontentsline{toc}{part}{References}
\printbibliography
\end{document}
