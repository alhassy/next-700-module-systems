module semantics-with-waist where

open import Level renaming (_âŠ”_ to _âŠ_; suc to â„“suc; zero to â„“â‚€)
open import Data.Nat
open import Data.Product
open import Relation.Binary.PropositionalEquality

Î£âˆ¶â€¢ : âˆ€ {a b} (A : Set a) (B : A â†’ Set b) â†’ Set _
Î£âˆ¶â€¢ = Î£

infix -666 Î£âˆ¶â€¢
syntax Î£âˆ¶â€¢ A (Î» x â†’ B) = Î£ x âˆ¶ A â€¢ B

record âŠ¤ {â„“} : Set â„“ where
  constructor tt

-- Expressions of the form â€œâ‹¯ , ttâ€ may now be written â€œâŸ¨ â‹¯ âŸ©â€

âŸ¨ : âˆ€ {â„“} {S : Set â„“} â†’ S â†’ S
âŸ¨ s = s

_âŸ© : âˆ€ {â„“} {S : Set â„“} â†’ S â†’ S Ã— âŠ¤ {â„“}
s âŸ© = s , tt

Context = Î» â„“ â†’ â„• â†’ Set â„“

infix -1000 â€µ_
â€µ_ : âˆ€ {â„“} â†’ Set â„“ â†’ Context â„“
â€µ S = Î» _ â†’ S

End : âˆ€ {â„“} â†’ Context â„“
End = â€µ âŠ¤

_>>=_ : âˆ€ {a b}
      â†’ (Î“ : Set a)  -- Main diference
      â†’ (Î“ â†’ Context b)
      â†’ Context (a âŠ b)
(Î“ >>= f) â„•.zero  = Î£ Î³ âˆ¶ Î“ â€¢ f Î³ 0
(Î“ >>= f) (suc n) = (Î³ : Î“) â†’ f Î³ n

Monoid : âˆ€ â„“ â†’ Context (â„“suc â„“)
Monoid â„“ = do Carrier â† Set â„“
              Id      â† Carrier
              _âŠ•_     â† (Carrier â†’ Carrier â†’ Carrier)
              leftId  â† âˆ€ {x : Carrier} â†’ x âŠ• Id â‰¡ x
              rightId â† âˆ€ {x : Carrier} â†’ Id âŠ• x â‰¡ x
              assoc   â† âˆ€ {x y z} â†’ (x âŠ• y) âŠ• z  â‰¡  x âŠ• (y âŠ• z)
              End {â„“}

DynamicSystem : Context (â„“suc Level.zero)
DynamicSystem = do X â† Set
                   z â† X
                   s â† (X â†’ X)
                   End {Level.zero}

-- Records with ğ“ƒ-Parameters, ğ“ƒ : 0..3
A B C D : Setâ‚
A = DynamicSystem 0 -- Î£ X âˆ¶ Set  â€¢ Î£ z âˆ¶ X  â€¢ Î£ s âˆ¶ X â†’ X  â€¢ âŠ¤
B = DynamicSystem 1 --  (X âˆ¶ Set) â†’ Î£ z âˆ¶ X  â€¢ Î£ s âˆ¶ X â†’ X  â€¢ âŠ¤
C = DynamicSystem 2 --  (X âˆ¶ Set)    (z âˆ¶ X) â†’ Î£ s âˆ¶ X â†’ X  â€¢ âŠ¤
D = DynamicSystem 3 --  (X âˆ¶ Set)    (z âˆ¶ X) â†’  (s âˆ¶ X â†’ X) â†’ âŠ¤

stablity : âˆ€ {n} â†’   DynamicSystem (3 + n)
                   â‰¡ DynamicSystem  3
stablity = refl

ğ’©â‚€ : DynamicSystem 0
ğ’©â‚€ = â„• , 0 , suc , tt

ğ’© : DynamicSystem 0
ğ’© = âŸ¨ â„• , 0 , suc âŸ©


