<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Do-it-yourself Module Systems</title>
<meta name="author" content="((link (:type https :path //alhassy.github.io/ :format bracket :raw-link https://alhassy.github.io/ :application nil :search-option nil :begin 1 :end 46 :contents-begin 31 :contents-end 44 :post-blank 0 :parent #0) Musa Al-hassy))"/>
<meta name="description" content="Unbundling on the fly and mechanically obtaining termtypes from theories"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/theme/sky.css" id="theme"/>

<link rel="stylesheet" href="./local.css"/>

<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'https://cdn.jsdelivr.net/npm/reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <style>
        /* From: https://endlessparentheses.com/public/css/endless.css */
        /* See also: https://meta.superuser.com/questions/4788/css-for-the-new-kbd-style */
        kbd
        {
          -moz-border-radius: 6px;
          -moz-box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
          -webkit-border-radius: 6px;
          -webkit-box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
          background-color: #f7f7f7;
          border: 1px solid #ccc;
          border-radius: 6px;
          box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
          color: #333;
          display: inline-block;
          font-family: 'Droid Sans Mono', monospace;
          font-size: 80%;
          font-weight: normal;
          line-height: inherit;
          margin: 0 .1em;
          padding: .08em .4em;
          text-shadow: 0 1px 0 #fff;
          word-spacing: -4px;

          box-shadow: 2px 2px 2px #222; /* MA: An extra I've added. */
        }
        </style>
        <link rel="stylesheet" type="text/css" href="https://alhassy.github.io/org-special-block-extras/tooltipster/dist/css/tooltipster.bundle.min.css"/>

        <link rel="stylesheet" type="text/css" href="https://alhassy.github.io/org-special-block-extras/tooltipster/dist/css/plugins/tooltipster/sideTip/themes/tooltipster-sideTip-punk.min.css" />

        <script type="text/javascript">
            if (typeof jQuery == 'undefined') {
                document.write(unescape('%3Cscript src="https://code.jquery.com/jquery-1.10.0.min.js"%3E%3C/script%3E'));
            }
        </script>

         <script type="text/javascript"            src="https://alhassy.github.io/org-special-block-extras/tooltipster/dist/js/tooltipster.bundle.min.js"></script>

          <script>
                 $(document).ready(function() {
                     $('.tooltip').tooltipster({
                         theme: 'tooltipster-punk',
                         contentAsHTML: true,
                         animation: 'grow',
                         delay: [100,500],
                         // trigger: 'click'
                         trigger: 'custom',
                         triggerOpen: {
                             mouseenter: true
                         },
                         triggerClose: {
                             originClick: true,
                             scroll: true
                         }
         });
                 });
             </script>

        <style>
           abbr {color: red;}

           .tooltip { border-bottom: 1px dotted #000;
                      color:red;
                      text-decoration: none;}
        </style>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide"><h2>Do-it-yourself Module Systems</h2>
<h5 style="color: green">Unbundling on the fly and mechanically obtaining termtypes from theories</h5>
<br><br>
<h4 style="color: rose"><emph>Agda Implementors Meeting 2020</emph></h4>
<br>
<h><a href="https://alhassy.github.io/">Musa Al-hassy</a></h3>
<br>
<font size="1">
<a href="?print-pdf&showNotes=true">
‚ü™ Flattened View ; Press <code>?</code> for Help ‚ü´
</a>
</font>
</section>

<style>

.reveal .slide-number {
  font-size: 34pt;
  color: #ff2D00; }

.reveal .slides {
  height: 100%;
  width: 100% !important ;
  top: 0;
  margin-top: 0;
}

.reveal .slides>section {
  min-height: 90%;
  min-width:  90%;
}

.reveal .slides>section>section {
  min-height: 100%;
}

.print-pdf .reveal .slides > section.present, .print-pdf .reveal .slides > section > section.present {
  min-height: 770px !important;
  position: relative !important;
}

.reveal table th, .reveal table td {
    text-align: left;
    border: none;
    border-left: 1px solid transparent;
    border-right: 1px solid transparent;
}

.reveal ul {
    line-height: 200%
}

.reveal ol {
    line-height: 200%
}

.reveal dl {
    line-height: 200%
}

.reveal p {
    line-height: 200%
}

.reveal pre {
    font-size: 1em;
    box-shadow:none;
}

</style>

<section>
<section id="slide-orge441456">
<h2 id="orge441456"><a href="#orge441456">Overview</a></h2>
<p>
With a bit of reflection, we can obtain
</p>

<ol>
<li class="fragment appear">a uniform, and <b>practical</b>, syntax for both <i>records</i> (semantics) and <i>termtypes</i> (syntax)</li>
<li class="fragment appear">on-the-fly unbundling; and,</li>
<li class="fragment appear"><p>
<b>mechanically</b> obtain data structures from theories
</p>
<small>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">‚Äòtheory‚Äô œÑ</th>
<th scope="col" class="org-left">‚Äòdata structure‚Äô <code>termtype œÑ</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">pointed set</td>
<td class="org-left">ùüô</td>
</tr>

<tr>
<td class="org-left">dynamic system</td>
<td class="org-left">‚Ñï</td>
</tr>

<tr>
<td class="org-left">monoid</td>
<td class="org-left">tree skeletons</td>
</tr>

<tr>
<td class="org-left">collections</td>
<td class="org-left">lists</td>
</tr>

<tr>
<td class="org-left">graphs</td>
<td class="org-left">(homogeneous) pairs</td>
</tr>

<tr>
<td class="org-left">actions</td>
<td class="org-left">infinite streams</td>
</tr>
</tbody>
</table>
</small></li>

</ol>
</section>
</section>
<section>
<section id="slide-orga676f75">
<h2 id="orga676f75"><a href="#orga676f75">Unbundling Problem</a></h2>
<div class="outline-text-2" id="text-orga676f75">
</div>
</section>
</section>
<section>
<section id="slide-orgc32c821">
<h3 id="orgc32c821"><a href="#orgc32c821">Monoid &#x2014;‚ÄúUntyped Composition‚Äù</a></h3>
<ul>
<li class="fragment appear">We have things, called <code class="src src-haskell"><span style="color: #ba2f59; font-weight: bold;">Carrier</span></code>,</li>
<li class="fragment appear">‚Ä¶ and we want to ‚Äòcombine‚Äô them via some operation <code class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #6c3163; font-weight: bold;">&#10814;</span><span style="color: #3a81c3; font-weight: bold;">_</span></code></li>
<li class="fragment appear">‚Ä¶ which has a ‚Äòdo nothing‚Äô value <code class="src src-haskell"><span style="color: #ba2f59; font-weight: bold;">Id</span></code>.</li>

</ul>

</section>
</section>
<section>
<section id="slide-org4660a3c">
<h3 id="org4660a3c"><a href="#org4660a3c">Typeclass approach, as in Haskell</a></h3>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #6c3163; font-weight: bold;">record</span> <span style="color: #ba2f59; font-weight: bold;">MonoidOn</span> (<span style="color: #ba2f59; font-weight: bold;">Carrier</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Set</span>) <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Set</span>
 <span style="color: #3a81c3; font-weight: bold;">where</span>
  field
    <span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #715ab1;">&#10814;</span><span style="color: #3a81c3; font-weight: bold;">_</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Carrier</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Carrier</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Carrier</span>
    <span style="color: #ba2f59; font-weight: bold;">Id</span>  <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Carrier</span>
    leftId <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #715ab1;">&#8704;</span> x <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Id</span> <span style="color: #715ab1;">&#10814;</span> x <span style="color: #715ab1;">&#8801;</span> x
    rightId <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #715ab1;">&#8704;</span> x <span style="color: #715ab1;">&#8594;</span> x <span style="color: #715ab1;">&#10814;</span> <span style="color: #ba2f59; font-weight: bold;">Id</span> <span style="color: #715ab1;">&#8801;</span> x
    assoc   <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #715ab1;">&#8704;</span> x y z <span style="color: #715ab1;">&#8594;</span>  (x <span style="color: #715ab1;">&#10814;</span> y) <span style="color: #715ab1;">&#10814;</span> z
                       <span style="color: #715ab1;">&#8801;</span>  x <span style="color: #715ab1;">&#10814;</span> (y <span style="color: #715ab1;">&#10814;</span> z)
</code></pre>
</div>

<div class="org-src-container">

<pre  class="fragment (appear)"><code trim><span style="color: #6c3163; font-weight: bold;">open</span> <span style="color: #ba2f59; font-weight: bold;">MonoidOn</span> {{<span style="color: #715ab1;">...</span>}}
</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-org60fc8ec">
<h3 id="org60fc8ec"><a href="#org60fc8ec">Examples</a></h3>
<ul>
<li class="fragment appear">Programs and sequential (or parallel) composition</li>
<li class="fragment appear"><b>Numbers and addition (or multiplication)</b></li>
<li class="fragment appear">Writing words on a page &#x2014;i.e., lists and catenation</li>

</ul>

</section>
</section>
<section>
<section id="slide-orgfb1b479">
<h3 id="orgfb1b479"><a href="#orgfb1b479">What is ‚Äúthe‚Äù monoid on the natural numbers?</a></h3>
<div class="outline-text-3" id="text-orgfb1b479">
</div>
</section>
<section id="slide-orgb773467">
<h4 id="orgb773467"><a href="#orgb773467">Additive?</a></h4>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #3a81c3; font-weight: bold;">instance</span>
  <span style="color: #ba2f59; font-weight: bold;">&#8469;</span><span style="color: #715ab1;">&#8330;</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">MonoidOn</span> <span style="color: #ba2f59; font-weight: bold;">&#8469;</span>
  <span style="color: #ba2f59; font-weight: bold;">&#8469;</span><span style="color: #715ab1;">&#8330;</span> <span style="color: #715ab1;">=</span> record { <span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #715ab1;">&#10814;</span><span style="color: #3a81c3; font-weight: bold;">_</span>     <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #715ab1;">+</span><span style="color: #3a81c3; font-weight: bold;">_</span>
              ; <span style="color: #ba2f59; font-weight: bold;">Id</span>      <span style="color: #715ab1;">=</span> 0
              ; leftId  <span style="color: #715ab1;">=</span> <span style="color: #715ab1;">+-</span>identity&#737;
              ; rightId <span style="color: #715ab1;">=</span> <span style="color: #715ab1;">+-</span>identity&#691;
              ;  assoc  <span style="color: #715ab1;">=</span> <span style="color: #715ab1;">+-</span>assoc }
</code></pre>
</div>

<div class="org-src-container">

<pre  class="fragment (appear)"><code trim>ex <span style="color: #6c3163; font-weight: bold;">:</span> <span style="color: #715ab1;">&#8704;</span> (m n <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">&#8469;</span>) <span style="color: #715ab1;">&#8594;</span> m <span style="color: #715ab1;">&#10814;</span> n  <span style="color: #715ab1;">&#8801;</span>  n <span style="color: #715ab1;">&#10814;</span> m
<span style="color: #6c3163; font-weight: bold;">ex</span> <span style="color: #715ab1;">=</span> <span style="color: #715ab1;">+-</span>comm
</code></pre>
</div>

<p class="fragment (appear)">
‚á® <code class="src src-haskell">__<span style="color: #6c3163; font-weight: bold;">&#10814;</span>__</code> is determined to be <code class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #6c3163; font-weight: bold;">+</span><span style="color: #3a81c3; font-weight: bold;">_</span></code>by <b>instance search</b> ‚á¶
</p>

<div class="org-src-container">

<pre  class="fragment (appear)"><code trim>likewise <span style="color: #6c3163; font-weight: bold;">:</span> <span style="color: #715ab1;">&#8704;</span> (m <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">&#8469;</span>) <span style="color: #715ab1;">&#8594;</span> m <span style="color: #715ab1;">&#10814;</span> <span style="color: #ba2f59; font-weight: bold;">Id</span> <span style="color: #715ab1;">&#8801;</span> m
<span style="color: #6c3163; font-weight: bold;">likewise</span> <span style="color: #715ab1;">=</span> rightId
</code></pre>
</div>

</section>
<section id="slide-org16a3a69">
<h4 id="org16a3a69"><a href="#org16a3a69">‚Ä¶ or Multiplicative?</a></h4>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #3a81c3; font-weight: bold;">instance</span>
  <span style="color: #ba2f59; font-weight: bold;">&#8469;&#8339;</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">MonoidOn</span> <span style="color: #ba2f59; font-weight: bold;">&#8469;</span>
  <span style="color: #ba2f59; font-weight: bold;">&#8469;&#8339;</span> <span style="color: #715ab1;">=</span> record { <span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #715ab1;">&#10814;</span><span style="color: #3a81c3; font-weight: bold;">_</span>     <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #715ab1;">*</span><span style="color: #3a81c3; font-weight: bold;">_</span>
              ; <span style="color: #ba2f59; font-weight: bold;">Id</span>      <span style="color: #715ab1;">=</span> 1
              ; leftId  <span style="color: #715ab1;">=</span> <span style="color: #715ab1;">*-</span>identity&#737;
              ; rightId <span style="color: #715ab1;">=</span> <span style="color: #715ab1;">*-</span>identity&#691;
              ; assoc   <span style="color: #715ab1;">=</span> <span style="color: #715ab1;">*-</span>assoc }
</code></pre>
</div>

<div class="org-src-container">

<pre  class="fragment (appear)"><code trim>whoops <span style="color: #6c3163; font-weight: bold;">:</span> <span style="color: #715ab1;">&#8704;</span> {m <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">&#8469;</span>} <span style="color: #715ab1;">&#8594;</span> m <span style="color: #715ab1;">&#10814;</span> <span style="color: #ba2f59; font-weight: bold;">Id</span> <span style="color: #715ab1;">&#8801;</span> m
<span style="color: #6c3163; font-weight: bold;">whoops</span> <span style="color: #715ab1;">=</span> {<span style="color: #715ab1;">!!</span>}
</code></pre>
</div>

<p class="fragment (appear)">
‚á® ‚Ñï‚Çä and ‚Ñï‚Çì are both candidates! <b>No unique solution!</b> ‚á¶
</p>

</section>
<section id="slide-org2d78a8a">
<h4 id="org2d78a8a"><a href="#org2d78a8a">Haskell's Solution</a></h4>
<p>
Make <b>two isomorphic copies</b> of numbers ‚Ä¶
</p>

<blockquote >
<p>
Some types can be viewed as a monoid in more than one way, e.g. both addition
and multiplication on numbers. In such cases we often define newtypes and make
those instances of Monoid, e.g. Sum and Product.
---<a href="https://hackage.haskell.org/package/base-4.14.0.0/docs/Data-Monoid.html#t:Monoid">Hackage Data.Monoid</a>
</p>
</blockquote>

<div class="org-src-container">

<pre  class="src src-haskell"><code trim><span style="color: #ba2f59; font-weight: bold;">Sum</span> &#945; <span style="color: #715ab1;">&#8773;</span> &#945;  <span style="color: #2aa1ae; background-color: #ecf3ec;">{- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">and -}</span> <span style="color: #ba2f59; font-weight: bold;">Product</span> &#945; <span style="color: #715ab1;">&#8773;</span> &#945;
</code></pre>
</div>
<p>
For <code class="src src-haskell"><span style="color: #ba2f59; font-weight: bold;">Num</span> &#945;</code> they have different monoid instances.
</p>

</section>
</section>
<section>
<section id="slide-orgb541f2e">
<h2 id="orgb541f2e"><a href="#orgb541f2e">Unbundling in Agda</a></h2>
<p class="fragment (appear)">
<b>Start</b> with <i>fully bundled</i> <code class="src src-haskell"><span style="color: #ba2f59; font-weight: bold;">Monoid</span></code>
</p>
<p class="fragment (appear)">
<b>then</b> <i>expose fields as parameters</i> <b>on the fly</b>.
</p>

</section>
</section>
<section>
<section id="slide-org831f276">
<h3 id="org831f276"><a href="#org831f276">How?</a></h3>
<p class="fragment (appear)">
<b>Reflection!</b>
</p>

<ul>
<li class="fragment appear">Unfortunately, current mechanism cannot touch
<code class="src src-agda2">record</code>-s <i>directly</i>.</li>
<li class="fragment appear">But every record is a Œ£-type (‚Ä¢ÃÄ·¥ó‚Ä¢ÃÅ)Ÿà</li>

</ul>

</section>
</section>
<section>
<section id="slide-org7edfa2e">
<h3 id="org7edfa2e"><a href="#org7edfa2e">Records as Œ†Œ£-types</a></h3>
<ul>
<li class="fragment appear"><p>
Instead of the nice <i>syntactic sugar</i>
</p>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #6c3163; font-weight: bold;">record</span> <span style="color: #ba2f59; font-weight: bold;">R</span> (&#949;&#185; <span style="color: #ba2f59; font-weight: bold;">:</span> &#964;&#185;) <span style="color: #715ab1;">&#8943;</span> (&#949;&#695; <span style="color: #ba2f59; font-weight: bold;">:</span> &#964;&#695;) <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Set</span>
  <span style="color: #3a81c3; font-weight: bold;">where</span>
    field
      &#949;&#695;<span style="color: #715ab1;">&#8314;</span>&#185; <span style="color: #ba2f59; font-weight: bold;">:</span> &#964;&#695;<span style="color: #715ab1;">&#8314;</span>&#185;
      <span style="color: #715ab1;">&#8942;</span>
      &#949;&#695;<span style="color: #715ab1;">&#8314;</span>&#7503; <span style="color: #ba2f59; font-weight: bold;">:</span> &#964;&#695;<span style="color: #715ab1;">&#8314;</span>&#7503;
</code></pre>
</div></li>

</ul>

<ul>
<li class="fragment appear"><p>
Use a more raw form  ---<i>eek!</i>
</p>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #ba2f59; font-weight: bold;">R</span>  <span style="color: #6c3163; font-weight: bold;">&#8773;</span>  <span style="color: #ba2f59; font-weight: bold;">&#928;</span> &#949;&#185; <span style="color: #ba2f59; font-weight: bold;">:</span> &#964;&#185; <span style="color: #715ab1;">&#8226;</span> <span style="color: #715ab1;">&#8943;</span> <span style="color: #715ab1;">&#8226;</span> <span style="color: #ba2f59; font-weight: bold;">&#928;</span> &#949;&#695; <span style="color: #ba2f59; font-weight: bold;">:</span> &#964;&#695;
    <span style="color: #715ab1;">&#8226;</span> <span style="color: #ba2f59; font-weight: bold;">&#931;</span> &#949;&#695;<span style="color: #715ab1;">&#8314;</span>&#185; <span style="color: #ba2f59; font-weight: bold;">:</span> &#964;&#695;<span style="color: #715ab1;">&#8314;</span>&#185; <span style="color: #715ab1;">&#8226;</span> <span style="color: #715ab1;">&#8943;</span> <span style="color: #715ab1;">&#8226;</span> <span style="color: #ba2f59; font-weight: bold;">&#931;</span> &#949;&#695;<span style="color: #715ab1;">&#8314;</span>&#7503; <span style="color: #ba2f59; font-weight: bold;">:</span> &#964;&#695;<span style="color: #715ab1;">&#8314;</span>&#7503;
    <span style="color: #715ab1;">&#8226;</span> &#120793;
</code></pre>
</div></li>

</ul>

</section>
</section>
<section>
<section id="slide-orgf5d7d07">
<h3 id="orgf5d7d07"><a href="#orgf5d7d07">Terminology</a></h3>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #ba2f59; font-weight: bold;">R</span>  <span style="color: #6c3163; font-weight: bold;">&#8773;</span>  <span style="color: #ba2f59; font-weight: bold;">&#928;</span> &#949;&#185; <span style="color: #ba2f59; font-weight: bold;">:</span> &#964;&#185; <span style="color: #715ab1;">&#8226;</span> <span style="color: #715ab1;">&#8943;</span> <span style="color: #715ab1;">&#8226;</span> <span style="color: #ba2f59; font-weight: bold;">&#928;</span> &#949;&#695; <span style="color: #ba2f59; font-weight: bold;">:</span> &#964;&#695;
    <span style="color: #715ab1;">&#8226;</span> <span style="color: #ba2f59; font-weight: bold;">&#931;</span> &#949;&#695;<span style="color: #715ab1;">&#8314;</span>&#185; <span style="color: #ba2f59; font-weight: bold;">:</span> &#964;&#695;<span style="color: #715ab1;">&#8314;</span>&#185; <span style="color: #715ab1;">&#8226;</span> <span style="color: #715ab1;">&#8943;</span> <span style="color: #715ab1;">&#8226;</span> <span style="color: #ba2f59; font-weight: bold;">&#931;</span> &#949;&#695;<span style="color: #715ab1;">&#8314;</span>&#7503; <span style="color: #ba2f59; font-weight: bold;">:</span> &#964;&#695;<span style="color: #715ab1;">&#8314;</span>&#7503;
    <span style="color: #715ab1;">&#8226;</span> &#120793;
</code></pre>
</div>

<p class="fragment (appear)">
‚á® <i>‚ÄúR is a Œ† ∑Œ£ type‚Äù</i>  &#x2014;a <b>(partitioned) context</b>
</p>
<p class="fragment (appear)">
‚á® It has <b>parameters</b> <code>Œµ‚Å∞, ‚Ä¶, Œµ ∑</code> and <b>fields</b> <code>Œµ ∑‚Å∫¬π, ‚Ä¶, Œµ ∑‚Å∫·µè</code>
</p>
<p class="fragment (appear)">
‚á® \(w\) is the <b>‚Äúwaist‚Äù</b>
</p>

<p class="fragment (appear)">
E.g., <code class="src src-haskell"><span style="color: #ba2f59; font-weight: bold;">MonoidOn</span></code> is a Œ†¬πŒ£ type
</p>

</section>
</section>
<section>
<section id="slide-org801b878">
<h3 id="org801b878"><a href="#org801b878">Shucks, the Unbundling Problem Strikes Again</a></h3>
<p>
If we encode a record as a Œ† ∑Œ£ type, what if we want
to <i>instantiate, fix,</i> a field &#x2014;instead of a parameter?
</p>

<p class="fragment (appear)">
We thus need a way to <b>lift parameters to fields</b>!
</p>
<p class="fragment (appear)">
( Teaser: <code class="src src-haskell"><span style="color: #ba2f59; font-weight: bold;">&#928;</span><span style="color: #715ab1;">&#8594;</span>&#955;</code> ! )
</p>

</section>
</section>
<section>
<section id="slide-org33fe105">
<h3 id="org33fe105"><a href="#org36c1ae5"><b>Pragmatic</b> Notation for Contexts</a></h3>
<p>
Instead of <code class="src src-agda2"><span style="color: #ba2f59; font-weight: bold;">Set</span></code>, use <code class="src src-agda2">(waist <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">&#8469;</span>) <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Set</span></code>
</p>

<ol>
<li class="fragment appear"><p>
‚ÄúContexts‚Äù are exposure-indexed types
</p>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #ba2f59; font-weight: bold;">Context</span> <span style="color: #715ab1;">=</span> &#955; &#8467; <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">&#8469;</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Set</span> &#8467;
</code></pre>
</div></li>
<li class="fragment appear"><p>
The ‚Äúempty context‚Äù is the unit type
</p>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #ba2f59; font-weight: bold;">End</span> <span style="color: #6c3163; font-weight: bold;">:</span> <span style="color: #715ab1;">&#8704;</span> {&#8467;} <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Context</span> &#8467;
<span style="color: #ba2f59; font-weight: bold;">End</span> {&#8467;} <span style="color: #715ab1;">=</span> <span style="color: #715ab1;">&#8245;</span> &#120793; {&#8467;}
</code></pre>
</div></li>
<li class="fragment appear"><p>
do-notation!
</p>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #6c3163; font-weight: bold;">&gt;&gt;=</span><span style="color: #3a81c3; font-weight: bold;">_</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #715ab1;">&#8704;</span> {a b}
      <span style="color: #715ab1;">&#8594;</span> (<span style="color: #ba2f59; font-weight: bold;">&#915;</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Context</span> a)
      <span style="color: #715ab1;">&#8594;</span> (<span style="color: #715ab1;">&#8704;</span> {n} <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">&#915;</span> n <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Context</span> b)
      <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Context</span> (a <span style="color: #715ab1;">&#8845;</span> b)
(<span style="color: #ba2f59; font-weight: bold;">&#915;</span> <span style="color: #715ab1;">&gt;&gt;=</span> f) zero    <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">&#931;</span> &#947; <span style="color: #715ab1;">&#8758;</span> <span style="color: #ba2f59; font-weight: bold;">&#915;</span> 0 <span style="color: #715ab1;">&#8226;</span> f &#947; 0
(<span style="color: #ba2f59; font-weight: bold;">&#915;</span> <span style="color: #715ab1;">&gt;&gt;=</span> f) (suc n) <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">&#928;</span> &#947; <span style="color: #715ab1;">&#8758;</span> <span style="color: #ba2f59; font-weight: bold;">&#915;</span> n <span style="color: #715ab1;">&#8226;</span> f &#947; n
</code></pre>
</div></li>
<li class="fragment appear" value="999">The <b>‚ÄúDIY‚Äù</b> lies at <code>&gt;&gt;=</code>, permitting Œ£, Œ†, ùí≤, <code>let</code>, ‚Ä¶ !</li>

</ol>

</section>
<section id="slide-org9753cb8">
<h4 id="org9753cb8"><a href="#org9753cb8">Example Context &#x2014;Monoids</a></h4>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #ba2f59; font-weight: bold;">Monoid</span> <span style="color: #6c3163; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Context</span> &#8467;&#8321;
<span style="color: #ba2f59; font-weight: bold;">Monoid</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span> <span style="color: #ba2f59; font-weight: bold;">Carrier</span> <span style="color: #715ab1;">&#8592;</span> <span style="color: #ba2f59; font-weight: bold;">Set</span>
            <span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #715ab1;">&#10814;</span><span style="color: #3a81c3; font-weight: bold;">_</span>     <span style="color: #715ab1;">&#8592;</span> (<span style="color: #ba2f59; font-weight: bold;">Carrier</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Carrier</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Carrier</span>)
            <span style="color: #ba2f59; font-weight: bold;">Id</span>      <span style="color: #715ab1;">&#8592;</span> <span style="color: #ba2f59; font-weight: bold;">Carrier</span>
            leftId  <span style="color: #715ab1;">&#8592;</span> <span style="color: #715ab1;">&#8704;</span> (x <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Carrier</span>) <span style="color: #715ab1;">&#8594;</span> x <span style="color: #715ab1;">&#10814;</span> <span style="color: #ba2f59; font-weight: bold;">Id</span> <span style="color: #715ab1;">&#8801;</span> x
            rightId <span style="color: #715ab1;">&#8592;</span> <span style="color: #715ab1;">&#8704;</span> (x <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Carrier</span>) <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Id</span> <span style="color: #715ab1;">&#10814;</span> x <span style="color: #715ab1;">&#8801;</span> x
            assoc   <span style="color: #715ab1;">&#8592;</span> <span style="color: #715ab1;">&#8704;</span> (x y z) <span style="color: #715ab1;">&#8594;</span> (x <span style="color: #715ab1;">&#10814;</span> y) <span style="color: #715ab1;">&#10814;</span> z  <span style="color: #715ab1;">&#8801;</span>  x <span style="color: #715ab1;">&#10814;</span> (y <span style="color: #715ab1;">&#10814;</span> z)
            <span style="color: #ba2f59; font-weight: bold;">End</span> {&#8467;}
</code></pre>
</div>

</section>
<section id="slide-org1d9f649">
<h4 id="org1d9f649"><a href="#org1d9f649">Example Instance &#x2014;Additive Naturals</a></h4>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #ba2f59; font-weight: bold;">&#8469;</span><span style="color: #715ab1;">&#8330;&#8242;</span> <span style="color: #ba2f59; font-weight: bold;">:</span> (<span style="color: #ba2f59; font-weight: bold;">Monoid</span> &#8467;&#8320; <span style="color: #ba2f59; font-weight: bold;">:</span>waist 1) <span style="color: #ba2f59; font-weight: bold;">&#8469;</span>
<span style="color: #ba2f59; font-weight: bold;">&#8469;</span><span style="color: #715ab1;">&#8330;&#8242;</span> <span style="color: #715ab1;">=</span> &#10216; <span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #715ab1;">+</span><span style="color: #3a81c3; font-weight: bold;">_</span>           <span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">_&#10814;_</span>
      , 0             <span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Id</span>
      , <span style="color: #715ab1;">+-</span>identity&#737;
      , <span style="color: #715ab1;">+-</span>identity&#691;
      , <span style="color: #715ab1;">+-</span>assoc
      &#10217;
</code></pre>
</div>

<p>
Notice&#x2026;
</p>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim>(<span style="color: #ba2f59; font-weight: bold;">Monoid</span> &#8467;&#8320; <span style="color: #ba2f59; font-weight: bold;">:</span>waist 1) <span style="color: #ba2f59; font-weight: bold;">&#8469;</span>  <span style="color: #715ab1;">&#8773;</span>  <span style="color: #ba2f59; font-weight: bold;">MonoidOn</span> <span style="color: #ba2f59; font-weight: bold;">&#8469;</span>
</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-org43feed1">
<h2 id="org43feed1"><a href="#org36c1ae5"><code class="src src-agda2"><span style="color: #ba2f59; font-weight: bold;">&#928;</span><span style="color: #715ab1;">&#8594;</span>&#955;</code> &#x2014;or <code class="src src-agda2"><span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #6c3163; font-weight: bold;">:</span>waist_</code></a></h2>
<dl>
<dt class="fragment appear">¬†</dt><dd class="fragment appear"><code class="src src-haskell">record</code></dd>
<dt class="fragment appear">‚âà</dt><dd class="fragment appear"><code class="src src-agda2"><span style="color: #ba2f59; font-weight: bold;">Context</span></code></dd>
<dt class="fragment appear">‚âà</dt><dd class="fragment appear">exposure-indexed type</dd>

</dl>

</section>
</section>
<section>
<section id="slide-org49a5e45">
<h3 id="org49a5e45"><a href="#org36c1ae5"><i>Using</i> ¬†¬†Contexts &#x2014;‚Äòreification‚Äô</a></h3>
<ul>
<li class="fragment appear"><p>
If <code class="src src-agda2"><span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #6c3163; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Context</span> &#8467;&#8320;</code> then <code class="src src-agda2"><span style="color: #ba2f59; font-weight: bold;">C</span> w <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">&#928;&#695;</span> <span style="color: #715ab1;">&#8943;</span> <span style="color: #715ab1;">&#8226;</span> <span style="color: #ba2f59; font-weight: bold;">Set</span></code>, but we want to <b>apply</b> <code>C w</code> to <i>w</i>-many <i>parameters</i>?
</p>

<p class="fragment (appear)">
 <small> <code>(Œ† ∑ x ‚Ä¢ œÑ)</code> is <i>w</i>-many Œ†'s binding variables to be used in
 type œÑ.  </small>
</p></li>

<li class="fragment appear"><p>
So we need a combinator&#x2026;
</p>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim> <span style="color: #ba2f59; font-weight: bold;">&#928;</span><span style="color: #715ab1;">&#8594;</span>&#955;  &#8220;<span style="color: #ba2f59; font-weight: bold;">&#928;&#695;</span> x <span style="color: #715ab1;">&#8226;</span> &#964;&#8221;   <span style="color: #715ab1;">=</span>   &#8220;&#955;&#695; x <span style="color: #715ab1;">&#8226;</span> &#964;&#8221;
</code></pre>
</div></li>
<li class="fragment appear"><p>
with an infix form for contexts in particular &#x2026;
</p>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #6c3163; font-weight: bold;">:</span>waist w   <span style="color: #715ab1;">=</span>   <span style="color: #ba2f59; font-weight: bold;">&#928;</span><span style="color: #715ab1;">&#8594;</span>&#955; (<span style="color: #ba2f59; font-weight: bold;">C</span> w)
</code></pre>
</div></li>

</ul>

</section>
</section>
<section>
<section id="slide-org1381fe2">
<h3 id="org1381fe2"><a href="#org1381fe2">Example</a></h3>
<small>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #ba2f59; font-weight: bold;">Monoid</span> <span style="color: #6c3163; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Context</span>
<span style="color: #ba2f59; font-weight: bold;">Monoid</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8592;</span> <span style="color: #ba2f59; font-weight: bold;">Set</span>; <span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #715ab1;">&#10814;</span><span style="color: #3a81c3; font-weight: bold;">_</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">C</span>; <span style="color: #ba2f59; font-weight: bold;">Id</span> <span style="color: #715ab1;">&#8592;</span> <span style="color: #ba2f59; font-weight: bold;">C</span>; <span style="color: #715ab1;">&#8230;</span>
</code></pre>
</div>
</small>

<small>
<p class="fragment appear">
With no parameters, we have a Œ†‚Å∞Œ£-type
</p>
</small>
<div class="org-src-container">

<pre  class="fragment appear"><code trim><span style="color: #ba2f59; font-weight: bold;">Monoid</span> <span style="color: #6c3163; font-weight: bold;">:</span>waist 0  <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Set</span>&#8321;
<span style="color: #ba2f59; font-weight: bold;">Monoid</span> <span style="color: #6c3163; font-weight: bold;">:</span>waist 0  <span style="color: #715ab1;">&#8801;</span>  <span style="color: #ba2f59; font-weight: bold;">&#931;</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Set</span> <span style="color: #715ab1;">&#8226;</span> <span style="color: #ba2f59; font-weight: bold;">&#931;</span> <span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #715ab1;">&#10814;</span><span style="color: #3a81c3; font-weight: bold;">_</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8226;</span> <span style="color: #ba2f59; font-weight: bold;">&#931;</span> <span style="color: #ba2f59; font-weight: bold;">Id</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8226;</span> <span style="color: #715ab1;">&#8230;</span>
</code></pre>
</div>

<small>
<p class="fragment appear">
With <b>one</b> parameter, we regain <code>MonoidOn</code>
</p>
</small>
<div class="org-src-container">

<pre  class="fragment appear"><code trim><span style="color: #ba2f59; font-weight: bold;">Monoid</span> <span style="color: #6c3163; font-weight: bold;">:</span>waist 1  <span style="color: #ba2f59; font-weight: bold;">:</span>  <span style="color: #ba2f59; font-weight: bold;">&#928;</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Set</span> <span style="color: #715ab1;">&#8226;</span> <span style="color: #ba2f59; font-weight: bold;">Set</span>
<span style="color: #ba2f59; font-weight: bold;">Monoid</span> <span style="color: #6c3163; font-weight: bold;">:</span>waist 1  <span style="color: #715ab1;">=</span>  &#955; <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Set</span> <span style="color: #715ab1;">&#8226;</span> <span style="color: #ba2f59; font-weight: bold;">&#931;</span> <span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #715ab1;">&#10814;</span><span style="color: #3a81c3; font-weight: bold;">_</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8226;</span> <span style="color: #ba2f59; font-weight: bold;">&#931;</span> <span style="color: #ba2f59; font-weight: bold;">Id</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8226;</span> <span style="color: #715ab1;">&#8230;</span>
</code></pre>
</div>

<small>
<p class="fragment appear">
With <b>two</b> parameters, we have a <i>‚Äòsolution‚Äô</i> to the
  additive-or-multiplicative-monoid-problem!
</p>
</small>
<div class="org-src-container">

<pre  class="fragment appear"><code trim><span style="color: #ba2f59; font-weight: bold;">Monoid</span> <span style="color: #6c3163; font-weight: bold;">:</span>waist 2  <span style="color: #ba2f59; font-weight: bold;">:</span>  <span style="color: #ba2f59; font-weight: bold;">&#928;</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Set</span>) <span style="color: #715ab1;">&#8226;</span> <span style="color: #ba2f59; font-weight: bold;">&#928;</span> <span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #715ab1;">&#10814;</span><span style="color: #3a81c3; font-weight: bold;">_</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8226;</span> <span style="color: #ba2f59; font-weight: bold;">Set</span>
<span style="color: #ba2f59; font-weight: bold;">Monoid</span> <span style="color: #6c3163; font-weight: bold;">:</span>waist 2  <span style="color: #715ab1;">=</span>  &#955; <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Set</span> <span style="color: #715ab1;">&#8226;</span> &#955; <span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #715ab1;">&#10814;</span><span style="color: #3a81c3; font-weight: bold;">_</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8226;</span> <span style="color: #ba2f59; font-weight: bold;">&#931;</span> <span style="color: #ba2f59; font-weight: bold;">Id</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8226;</span> <span style="color: #715ab1;">&#8230;</span>
</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-org5a55f25">
<h3 id="org5a55f25"><a href="#org5a55f25">Relationships between various forms</a></h3>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #ba2f59; font-weight: bold;">Monoid</span> <span style="color: #6c3163; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Context</span> <span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">i.e., (w : &#8469;) &#8594; Set</span>

<span style="color: #ba2f59; font-weight: bold;">Monoid</span> <span style="color: #6c3163; font-weight: bold;">:</span>waist &#120012;   <span style="color: #ba2f59; font-weight: bold;">:</span>  <span style="color: #ba2f59; font-weight: bold;">&#928;&#695;</span> <span style="color: #715ab1;">&#8943;</span> <span style="color: #715ab1;">&#8226;</span> <span style="color: #ba2f59; font-weight: bold;">Set</span>
<span style="color: #ba2f59; font-weight: bold;">Monoid</span> <span style="color: #6c3163; font-weight: bold;">:</span>waist &#120012;   <span style="color: #715ab1;">=</span>  &#955;&#695; &#8220;parameters&#8221; <span style="color: #715ab1;">&#8226;</span> &#8220;fields&#8221;
</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-org4433126">
<h3 id="org4433126"><a href="#org4433126">11 Line Implementation &#x2014;thanks Ulf!</a></h3>
<div class="outline-text-3" id="text-org4433126">
</div>
</section>
<section id="slide-org477af38">
<h4 id="org477af38"><a href="#org477af38">The Core <span class="underline">Syntactic</span> Transformation</a></h4>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #2aa1ae; background-color: #ecf3ec;">--  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">&#928; a : A &#8226; B a   &#8614;   &#955; a : A &#8226; B a</span>

<span style="color: #ba2f59; font-weight: bold;">&#928;</span><span style="color: #715ab1;">&#8594;</span>&#955;<span style="color: #715ab1;">-</span>helper <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Term</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Term</span>

<span style="color: #ba2f59; font-weight: bold;">&#928;</span><span style="color: #715ab1;">&#8594;</span>&#955;<span style="color: #715ab1;">-</span>helper (pi a (abs x b))
  <span style="color: #715ab1;">=</span> lam visible (abs x (<span style="color: #ba2f59; font-weight: bold;">&#928;</span><span style="color: #715ab1;">&#8594;</span>&#955;<span style="color: #715ab1;">-</span>helper b))

<span style="color: #ba2f59; font-weight: bold;">&#928;</span><span style="color: #715ab1;">&#8594;</span>&#955;<span style="color: #715ab1;">-</span>helper x
  <span style="color: #715ab1;">=</span> x
</code></pre>
</div>

</section>
<section id="slide-orgd050a2b">
<h4 id="orgd050a2b"><a href="#orgd050a2b">Keeping Track of Types</a></h4>
<p>
<code class="src src-agda2"><span style="color: #ba2f59; font-weight: bold;">Term</span></code> denotes untyped Œª-terms,
so let's keep track of the types when we convert Œ†s to Œªs.
</p>

<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #ba2f59; font-weight: bold;">&#928;</span><span style="color: #715ab1;">&#8594;</span>&#955;<span style="color: #715ab1;">-</span><span style="color: #3a81c3; font-weight: bold;">type</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Term</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Term</span>

<span style="color: #ba2f59; font-weight: bold;">&#928;</span><span style="color: #715ab1;">&#8594;</span>&#955;<span style="color: #715ab1;">-</span><span style="color: #3a81c3; font-weight: bold;">type</span> (pi a (abs x b))
 <span style="color: #715ab1;">=</span> pi a  (abs x (<span style="color: #ba2f59; font-weight: bold;">&#928;</span><span style="color: #715ab1;">&#8594;</span>&#955;<span style="color: #715ab1;">-</span><span style="color: #3a81c3; font-weight: bold;">type</span> b))

<span style="color: #ba2f59; font-weight: bold;">&#928;</span><span style="color: #715ab1;">&#8594;</span>&#955;<span style="color: #715ab1;">-</span><span style="color: #3a81c3; font-weight: bold;">type</span> x
 <span style="color: #715ab1;">=</span> unknown
</code></pre>
</div>

</section>
<section id="slide-org7be6caa">
<h4 id="org7be6caa"><a href="#org7be6caa">Putting them together</a></h4>
<small>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #6c3163; font-weight: bold;">macro</span>
  <span style="color: #ba2f59; font-weight: bold;">&#928;</span><span style="color: #715ab1;">&#8594;</span>&#955; <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Term</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Term</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">TC</span> <span style="color: #715ab1;">Unit.&#8868;</span>
  <span style="color: #ba2f59; font-weight: bold;">&#928;</span><span style="color: #715ab1;">&#8594;</span>&#955; &#964; goal
   <span style="color: #715ab1;">=</span>  normalise &#964;
       <span style="color: #715ab1;">&gt;&gt;=</span>&#8348;&#8337;&#7523;&#8344; &#955; &#964;<span style="color: #715ab1;">&#8242;</span> <span style="color: #715ab1;">&#8594;</span> checkType goal (<span style="color: #ba2f59; font-weight: bold;">&#928;</span><span style="color: #715ab1;">&#8594;</span>&#955;<span style="color: #715ab1;">-</span><span style="color: #3a81c3; font-weight: bold;">type</span> &#964;<span style="color: #715ab1;">&#8242;</span>)
       <span style="color: #715ab1;">&gt;&gt;=</span>&#8348;&#8337;&#7523;&#8344; &#955; <span style="color: #3a81c3; font-weight: bold;">_</span> <span style="color: #715ab1;">&#8594;</span>  unify goal (<span style="color: #ba2f59; font-weight: bold;">&#928;</span><span style="color: #715ab1;">&#8594;</span>&#955;<span style="color: #715ab1;">-</span>helper &#964;<span style="color: #715ab1;">&#8242;</span>)
</code></pre>
</div>
</small>

</section>
</section>
<section>
<section id="slide-org87dc7a0">
<h3 id="org87dc7a0"><a href="#org87dc7a0">Lesson Learned</a></h3>
<p>
On-the-fly unbundling can be implemented as an in-language library in a
dependently-typed language with sufficient reflection capabilities (‚Ä¢ÃÄ·¥ó‚Ä¢ÃÅ)Ÿà
</p>

</section>
</section>
<section>
<section id="slide-org0420824">
<h2 id="org0420824"><a href="#org0420824">GADTs are Contexts too!</a></h2>
<small>
<dl>
<dt class="fragment appear">¬†</dt><dd class="fragment appear"><code class="src src-agda2"><span style="color: #ba2f59; font-weight: bold;">Monoid</span></code></dd>
<dt class="fragment appear">‚üø</dt><dd class="fragment appear"><code class="src src-agda2"><span style="color: #3a81c3; font-weight: bold;">do</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8592;</span> <span style="color: #ba2f59; font-weight: bold;">Set</span>; <span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #715ab1;">&#10814;</span><span style="color: #3a81c3; font-weight: bold;">_</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">C</span>; <span style="color: #ba2f59; font-weight: bold;">Id</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">C</span>; <span style="color: #715ab1;">&#8230;</span></code></dd>
<dt class="fragment appear">‚üø</dt><dd class="fragment appear"><code class="src src-agda2"><span style="color: #6c3163; font-weight: bold;">&#955;</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Set</span> <span style="color: #715ab1;">&#8226;</span> <span style="color: #ba2f59; font-weight: bold;">&#931;</span> <span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #715ab1;">&#10814;</span><span style="color: #3a81c3; font-weight: bold;">_</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8226;</span> <span style="color: #ba2f59; font-weight: bold;">&#931;</span> <span style="color: #ba2f59; font-weight: bold;">Id</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8226;</span> <span style="color: #715ab1;">&#8230;</span></code></dd>
<dt class="fragment appear">‚üø</dt><dd class="fragment appear"><code class="src src-agda2"><span style="color: #6c3163; font-weight: bold;">&#955;</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Set</span> <span style="color: #715ab1;">&#8226;</span> <span style="color: #ba2f59; font-weight: bold;">&#931;</span> <span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #715ab1;">&#10814;</span><span style="color: #3a81c3; font-weight: bold;">_</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8226;</span> <span style="color: #ba2f59; font-weight: bold;">&#931;</span> <span style="color: #ba2f59; font-weight: bold;">Id</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8226;</span> &#120793;</code></dd>
<dt class="fragment appear">‚üø</dt><dd class="fragment appear"><code class="src src-agda2"><span style="color: #6c3163; font-weight: bold;">&#955;</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Set</span> <span style="color: #715ab1;">&#8226;</span>       <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#215;</span> <span style="color: #ba2f59; font-weight: bold;">C</span>    <span style="color: #715ab1;">&#8845;</span>         <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8845;</span> &#120793;</code></dd>
<dt class="fragment appear">‚üø</dt><dd class="fragment appear"><code class="src src-agda2"><span style="color: #6c3163; font-weight: bold;">&#956;</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Set</span> <span style="color: #715ab1;">&#8226;</span>       <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#215;</span> <span style="color: #ba2f59; font-weight: bold;">C</span>    <span style="color: #715ab1;">&#8845;</span>         <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">&#8845;</span> &#120793;</code></dd>

</dl>
</small>
</section>
</section>
<section>
<section id="slide-org2250d77">
<h3 id="org2250d77"><a href="#org2250d77">As a macro!</a></h3>
<pre class="example" id="org6dcf547">
termtype : UnaryFunctor ‚Üí Type
termtype œÑ = Fix (Œ£‚Üí‚äé (sources œÑ))
</pre>

<hr />

<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #6c3163; font-weight: bold;">macro</span>
  termtype <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Term</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Term</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">TC</span> <span style="color: #715ab1;">Unit.&#8868;</span>
  termtype tm goal <span style="color: #715ab1;">=</span>
                normalise tm
           <span style="color: #715ab1;">&gt;&gt;=</span>&#8348;&#8337;&#7523;&#8344; &#955; tm<span style="color: #715ab1;">&#8242;</span> <span style="color: #715ab1;">&#8594;</span> unify goal (def (quote <span style="color: #ba2f59; font-weight: bold;">Fix</span>) ((vArg (<span style="color: #ba2f59; font-weight: bold;">&#931;</span><span style="color: #715ab1;">&#8594;&#8846;</span>&#8320; (sources&#8348;&#8337;&#7523;&#8344; tm<span style="color: #715ab1;">&#8242;</span>))) <span style="color: #715ab1;">&#8759;</span> <span style="color: #ba2f59; font-weight: bold;">[]</span>))
</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-org4941614">
<h3 id="org4941614"><a href="#org4941614">Monoids give rise to tree skeletons</a></h3>
<div class="outline-text-3" id="text-org4941614">
</div>
</section>
<section id="slide-org39802a2">
<h4 id="org39802a2"><a href="#org39802a2">Context</a></h4>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #ba2f59; font-weight: bold;">Monoid</span> <span style="color: #6c3163; font-weight: bold;">:</span> <span style="color: #715ab1;">&#8704;</span> &#8467; <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Context</span> (&#8467;suc &#8467;)
<span style="color: #ba2f59; font-weight: bold;">Monoid</span> &#8467; <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span> <span style="color: #ba2f59; font-weight: bold;">Carrier</span> <span style="color: #715ab1;">&#8592;</span> <span style="color: #ba2f59; font-weight: bold;">Set</span> &#8467;
              <span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #715ab1;">&#10814;</span><span style="color: #3a81c3; font-weight: bold;">_</span>     <span style="color: #715ab1;">&#8592;</span> (<span style="color: #ba2f59; font-weight: bold;">Carrier</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Carrier</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Carrier</span>)
              <span style="color: #ba2f59; font-weight: bold;">Id</span>      <span style="color: #715ab1;">&#8592;</span> <span style="color: #ba2f59; font-weight: bold;">Carrier</span>
              leftId  <span style="color: #715ab1;">&#8592;</span> <span style="color: #715ab1;">&#8704;</span> {x <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Carrier</span>} <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Id</span> <span style="color: #715ab1;">&#10814;</span> x <span style="color: #715ab1;">&#8801;</span> x
              rightId <span style="color: #715ab1;">&#8592;</span> <span style="color: #715ab1;">&#8704;</span> {x <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Carrier</span>} <span style="color: #715ab1;">&#8594;</span> x <span style="color: #715ab1;">&#10814;</span> <span style="color: #ba2f59; font-weight: bold;">Id</span> <span style="color: #715ab1;">&#8801;</span> x
              assoc   <span style="color: #715ab1;">&#8592;</span> <span style="color: #715ab1;">&#8704;</span> {x y z} <span style="color: #715ab1;">&#8594;</span> (x <span style="color: #715ab1;">&#10814;</span> y) <span style="color: #715ab1;">&#10814;</span> z  <span style="color: #715ab1;">&#8801;</span>  x <span style="color: #715ab1;">&#10814;</span> (y <span style="color: #715ab1;">&#10814;</span> z)
              <span style="color: #ba2f59; font-weight: bold;">End</span> {&#8467;}
</code></pre>
</div>

</section>
<section id="slide-org758ef41">
<h4 id="org758ef41"><a href="#org758ef41">Termtype</a></h4>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim>  <span style="color: #ba2f59; font-weight: bold;">&#120132;</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Set</span>
  <span style="color: #ba2f59; font-weight: bold;">&#120132;</span> <span style="color: #715ab1;">=</span> termtype (<span style="color: #ba2f59; font-weight: bold;">Monoid</span> &#8467;&#8320; <span style="color: #ba2f59; font-weight: bold;">:</span>waist 1)
</code></pre>
</div>

<div class="org-src-container">

<pre  class="src src-agda2"><code trim>  that<span style="color: #715ab1;">-</span>is <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">&#120132;</span>
          <span style="color: #715ab1;">&#8801;</span> <span style="color: #ba2f59; font-weight: bold;">Fix</span> (&#955; <span style="color: #ba2f59; font-weight: bold;">X</span> <span style="color: #715ab1;">&#8594;</span>
                <span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">_&#8853;_, branch</span>
                <span style="color: #ba2f59; font-weight: bold;">X</span> <span style="color: #715ab1;">&#215;</span> <span style="color: #ba2f59; font-weight: bold;">X</span> <span style="color: #715ab1;">&#215;</span> &#120793;
                <span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Id, nil leaf</span>
              <span style="color: #715ab1;">&#8846;</span> &#120793;
                <span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">invariant leftId</span>
              <span style="color: #715ab1;">&#8846;</span> &#120792;
                <span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">invariant rightId</span>
              <span style="color: #715ab1;">&#8846;</span> &#120792;
                <span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">invariant assoc</span>
              <span style="color: #715ab1;">&#8846;</span> &#120792;
                <span style="color: #2aa1ae; background-color: #ecf3ec;">--  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">the &#8220;End {&#8467;}&#8221;</span>
              <span style="color: #715ab1;">&#8846;</span> &#120792;)
  that<span style="color: #715ab1;">-</span>is <span style="color: #715ab1;">=</span> refl
</code></pre>
</div>

</section>
<section id="slide-org4bf665f">
<h4 id="org4bf665f"><a href="#org4bf665f">Pattern synonyms for more compact presentation</a></h4>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">: &#120132;</span>
<span style="color: #3a81c3; font-weight: bold;">pattern</span> emptyM
    <span style="color: #715ab1;">=</span> &#956; (inj&#8322; (inj&#8321; tt))
</code></pre>
</div>

<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">: &#120132; &#8594; &#120132; &#8594; &#120132;</span>
<span style="color: #3a81c3; font-weight: bold;">pattern</span> branchM l r
    <span style="color: #715ab1;">=</span> &#956; (inj&#8321; (l , r , tt))
</code></pre>
</div>

<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">absurd &#120792;-values</span>
<span style="color: #3a81c3; font-weight: bold;">pattern</span> absurdM a
    <span style="color: #715ab1;">=</span> &#956; (inj&#8322; (inj&#8322; (inj&#8322; (inj&#8322; a))))
</code></pre>
</div>

</section>
<section id="slide-org7ada514">
<h4 id="org7ada514"><a href="#org36c1ae5"><code>termtype Monoid ‚âÖ TreeSkeleton</code></a></h4>
<div class="org-src-container">

<pre  class="fragment (appear)"><code trim>  <span style="color: #3a81c3; font-weight: bold;">data</span> <span style="color: #ba2f59; font-weight: bold;">TreeSkeleton</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Set</span> <span style="color: #3a81c3; font-weight: bold;">where</span>
    empty  <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">TreeSkeleton</span>
    branch <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">TreeSkeleton</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">TreeSkeleton</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">TreeSkeleton</span>
</code></pre>
</div>


<ul>
<li class="fragment appear"><p>
‚Äúdoing nothing‚Äù
</p>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim>  to <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">&#120132;</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">TreeSkeleton</span>
  to emptyM        <span style="color: #715ab1;">=</span> empty
  to (branchM l r) <span style="color: #715ab1;">=</span> branch (to l) (to r)
  to (absurdM (inj&#8321; <span style="color: #ba2f59; font-weight: bold;">()</span>))
  to (absurdM (inj&#8322; <span style="color: #ba2f59; font-weight: bold;">()</span>))
</code></pre>
</div></li>

</ul>


<ul>
<li class="fragment appear"><p>
‚Äúdoing nothing‚Äù
</p>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim>  from <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">TreeSkeleton</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">&#120132;</span>
  from empty        <span style="color: #715ab1;">=</span> emptyM
  from (branch l r) <span style="color: #715ab1;">=</span> branchM (from l) (from r)
</code></pre>
</div></li>

</ul>

</section>
</section>
<section>
<section id="slide-orgffa8abf">
<h3 id="orgffa8abf"><a href="#orgffa8abf">Dynamical Systems give rise to ‚Ñï</a></h3>
<div class="outline-text-3" id="text-orgffa8abf">
</div>
</section>
<section id="slide-orge4c7093">
<h4 id="orge4c7093"><a href="#orge4c7093">Context</a></h4>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #ba2f59; font-weight: bold;">DynamicSystem</span> <span style="color: #6c3163; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Context</span> &#8467;&#8321;
<span style="color: #ba2f59; font-weight: bold;">DynamicSystem</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span> <span style="color: #ba2f59; font-weight: bold;">State</span> <span style="color: #715ab1;">&#8592;</span> <span style="color: #ba2f59; font-weight: bold;">Set</span>
                   start <span style="color: #715ab1;">&#8592;</span> <span style="color: #ba2f59; font-weight: bold;">State</span>
                   next  <span style="color: #715ab1;">&#8592;</span> (<span style="color: #ba2f59; font-weight: bold;">State</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">State</span>)
                   <span style="color: #ba2f59; font-weight: bold;">End</span> {&#8467;&#8320;}
</code></pre>
</div>

</section>
<section id="slide-org129d1d0">
<h4 id="org129d1d0"><a href="#org129d1d0">Termtype</a></h4>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #ba2f59; font-weight: bold;">&#120123;</span> <span style="color: #715ab1;">=</span> termtype (<span style="color: #ba2f59; font-weight: bold;">DynamicSystem</span> <span style="color: #ba2f59; font-weight: bold;">:</span>waist 1)
</code></pre>
</div>
<p>
Pattern synonyms for more compact presentation
</p>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">: &#120123;</span>
<span style="color: #3a81c3; font-weight: bold;">pattern</span> startD
    <span style="color: #715ab1;">=</span> &#956; (inj&#8321; tt)

<span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">: &#120123; &#8594; &#120123;</span>
<span style="color: #3a81c3; font-weight: bold;">pattern</span> nextD e <span style="color: #715ab1;">=</span> &#956; (inj&#8322; (inj&#8321; e))
</code></pre>
</div>

</section>
<section id="slide-org3bd0ac7">
<h4 id="org3bd0ac7"><a href="#org36c1ae5"><code>termtype ùîª ‚âÖ ‚Ñï</code></a></h4>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim>    to <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">&#120123;</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">&#8469;</span>
    to startD    <span style="color: #715ab1;">=</span> 0
    to (nextD x) <span style="color: #715ab1;">=</span> suc (to x)

    from <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">&#8469;</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">&#120123;</span>
    from zero    <span style="color: #715ab1;">=</span> startD
    from (suc n) <span style="color: #715ab1;">=</span> nextD (from n)
</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-orgfde36c2">
<h3 id="orgfde36c2"><a href="#orgfde36c2">Pointed Sets give rise to terminal types</a></h3>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #ba2f59; font-weight: bold;">PSet</span>  <span style="color: #6c3163; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Context</span> (&#8467;suc &#8467;&#8320;)
<span style="color: #ba2f59; font-weight: bold;">PSet</span>  <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span> <span style="color: #ba2f59; font-weight: bold;">Carrier</span> <span style="color: #715ab1;">&#8592;</span> <span style="color: #ba2f59; font-weight: bold;">Set</span> &#8467;&#8320;
           point  <span style="color: #715ab1;">&#8592;</span> <span style="color: #ba2f59; font-weight: bold;">Carrier</span>
           <span style="color: #ba2f59; font-weight: bold;">End</span> {&#8467;&#8320;}
</code></pre>
</div>

<div class="org-src-container">

<pre  class="fragment appear"><code trim><span style="color: #ba2f59; font-weight: bold;">&#8473;&#120138;&#120150;&#120165;</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Set</span>
<span style="color: #ba2f59; font-weight: bold;">&#8473;&#120138;&#120150;&#120165;</span> <span style="color: #715ab1;">=</span> termtype (<span style="color: #ba2f59; font-weight: bold;">PSet</span> <span style="color: #ba2f59; font-weight: bold;">:</span>waist 1)
</code></pre>
</div>

<div class="org-src-container">

<pre  class="fragment appear"><code trim>to <span style="color: #6c3163; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">&#8473;&#120138;&#120150;&#120165;</span> <span style="color: #715ab1;">&#8594;</span> &#120793; {&#8467;&#8320;}
<span style="color: #6c3163; font-weight: bold;">to</span> emptyM <span style="color: #715ab1;">=</span> tt

from <span style="color: #6c3163; font-weight: bold;">:</span> &#120793; {&#8467;&#8320;} <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">&#8473;&#120138;&#120150;&#120165;</span>
<span style="color: #6c3163; font-weight: bold;">from</span> <span style="color: #3a81c3; font-weight: bold;">_</span> <span style="color: #715ab1;">=</span> &#956; (inj&#8321; tt)
</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-org70c0e49">
<h3 id="org70c0e49"><a href="#org70c0e49">(Simple) Graphs give rise to pairs</a></h3>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #ba2f59; font-weight: bold;">Graph</span>  <span style="color: #6c3163; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Context</span> (&#8467;suc &#8467;&#8320;)
<span style="color: #ba2f59; font-weight: bold;">Graph</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span> <span style="color: #ba2f59; font-weight: bold;">Node</span> <span style="color: #715ab1;">&#8592;</span> <span style="color: #ba2f59; font-weight: bold;">Set</span>
           <span style="color: #ba2f59; font-weight: bold;">Edge</span> <span style="color: #715ab1;">&#8592;</span> <span style="color: #ba2f59; font-weight: bold;">Set</span>
           adjacency <span style="color: #715ab1;">&#8592;</span> (<span style="color: #ba2f59; font-weight: bold;">Node</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Node</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Edge</span>)
           <span style="color: #ba2f59; font-weight: bold;">End</span> {&#8467;&#8320;}
</code></pre>
</div>

<div class="org-src-container">

<pre  class="fragment appear"><code trim><span style="color: #ba2f59; font-weight: bold;">&#120126;&#120163;&#120146;&#120161;&#120153;</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Set</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Set</span>
<span style="color: #ba2f59; font-weight: bold;">&#120126;&#120163;&#120146;&#120161;&#120153;</span> <span style="color: #ba2f59; font-weight: bold;">X</span> <span style="color: #715ab1;">=</span> termtype ((<span style="color: #ba2f59; font-weight: bold;">Graph</span> <span style="color: #ba2f59; font-weight: bold;">:</span>waist 2) <span style="color: #ba2f59; font-weight: bold;">X</span>)
</code></pre>
</div>

<div class="org-src-container">

<pre  class="fragment appear"><code trim><span style="color: #3a81c3; font-weight: bold;">pattern</span> <span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #715ab1;">&#8652;</span><span style="color: #3a81c3; font-weight: bold;">_</span> x y <span style="color: #715ab1;">=</span> &#956; (inj&#8321; (x , y , tt))

view <span style="color: #6c3163; font-weight: bold;">:</span> <span style="color: #715ab1;">&#8704;</span> {<span style="color: #ba2f59; font-weight: bold;">X</span>} <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">&#120126;&#120163;&#120146;&#120161;&#120153;</span> <span style="color: #ba2f59; font-weight: bold;">X</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">X</span> <span style="color: #715ab1;">&#215;</span> <span style="color: #ba2f59; font-weight: bold;">X</span>
<span style="color: #6c3163; font-weight: bold;">view</span> (x <span style="color: #715ab1;">&#8652;</span> y) <span style="color: #715ab1;">=</span> x , y
</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-orgeca65c6">
<h3 id="orgeca65c6"><a href="#orgeca65c6">Indexed unary algebras (‚Äúactions‚Äù) give rise to streams</a></h3>
<div class="outline-text-3" id="text-orgeca65c6">
</div>
</section>
<section id="slide-org7683e37">
<h4 id="org7683e37"><a href="#org7683e37">Context</a></h4>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #ba2f59; font-weight: bold;">Action</span>  <span style="color: #6c3163; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Context</span> &#8467;&#8321;
<span style="color: #ba2f59; font-weight: bold;">Action</span>  <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span> <span style="color: #ba2f59; font-weight: bold;">Value</span>    <span style="color: #715ab1;">&#8592;</span> <span style="color: #ba2f59; font-weight: bold;">Set</span>
             <span style="color: #ba2f59; font-weight: bold;">Program</span>  <span style="color: #715ab1;">&#8592;</span> <span style="color: #ba2f59; font-weight: bold;">Set</span>
             run      <span style="color: #715ab1;">&#8592;</span> (<span style="color: #ba2f59; font-weight: bold;">Program</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Value</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Value</span>)
             <span style="color: #ba2f59; font-weight: bold;">End</span> {&#8467;&#8320;}
</code></pre>
</div>
</section>
<section id="slide-org6c3e046">
<h4 id="org6c3e046"><a href="#org6c3e046">Termtype</a></h4>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #ba2f59; font-weight: bold;">&#120120;&#120148;&#120165;&#120154;&#120160;&#120159;</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Set</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Set</span>
<span style="color: #ba2f59; font-weight: bold;">&#120120;&#120148;&#120165;&#120154;&#120160;&#120159;</span> <span style="color: #ba2f59; font-weight: bold;">X</span> <span style="color: #715ab1;">=</span> termtype ((<span style="color: #ba2f59; font-weight: bold;">Action</span> <span style="color: #ba2f59; font-weight: bold;">:</span>waist 2) <span style="color: #ba2f59; font-weight: bold;">X</span>)
</code></pre>
</div>

<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">: X &#8594; &#120120;&#120148;&#120165;&#120154;&#120160;&#120159; X &#8594; &#120120;&#120148;&#120165;&#120154;&#120160;&#120159; X</span>
<span style="color: #3a81c3; font-weight: bold;">pattern</span> <span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #715ab1;">&#8759;</span><span style="color: #3a81c3; font-weight: bold;">_</span> head tail
         <span style="color: #715ab1;">=</span> &#956; (inj&#8321; (tail , head , tt))
</code></pre>
</div>

</section>
<section id="slide-org308ec59">
<h4 id="org308ec59"><a href="#org308ec59">‚Ä¶ to stream</a></h4>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #6c3163; font-weight: bold;">record</span> <span style="color: #ba2f59; font-weight: bold;">Stream</span> (<span style="color: #ba2f59; font-weight: bold;">X</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Set</span>) <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Set</span>   <span style="color: #3a81c3; font-weight: bold;">where</span>
  coinductive
  field
    hd <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">X</span>
    tl <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Stream</span> <span style="color: #ba2f59; font-weight: bold;">X</span>

<span style="color: #6c3163; font-weight: bold;">open</span> <span style="color: #ba2f59; font-weight: bold;">Stream</span>
</code></pre>
</div>
<div class="org-src-container">

<pre  class="fragment appear"><code trim>view <span style="color: #6c3163; font-weight: bold;">:</span> <span style="color: #715ab1;">&#8704;</span> {<span style="color: #ba2f59; font-weight: bold;">I</span>} <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">&#120120;&#120148;&#120165;&#120154;&#120160;&#120159;</span> <span style="color: #ba2f59; font-weight: bold;">I</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Stream</span> <span style="color: #ba2f59; font-weight: bold;">I</span>
<span style="color: #6c3163; font-weight: bold;">hd</span> (view (h <span style="color: #715ab1;">&#8759;</span> t)) <span style="color: #715ab1;">=</span> h
<span style="color: #6c3163; font-weight: bold;">tl</span> (view (h <span style="color: #715ab1;">&#8759;</span> t)) <span style="color: #715ab1;">=</span> view t
</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-orgaa0566d">
<h3 id="orgaa0566d"><a href="#orgaa0566d">Collection theories give rise to lists</a></h3>
<div class="org-src-container">

<pre  class="src src-agda2"><code trim><span style="color: #ba2f59; font-weight: bold;">Collection</span> <span style="color: #6c3163; font-weight: bold;">:</span> <span style="color: #715ab1;">&#8704;</span> &#8467; <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Context</span> (&#8467;suc &#8467;)
<span style="color: #ba2f59; font-weight: bold;">Collection</span> &#8467; <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span> <span style="color: #ba2f59; font-weight: bold;">Elem</span>      <span style="color: #715ab1;">&#8592;</span> <span style="color: #ba2f59; font-weight: bold;">Set</span> &#8467;
                  <span style="color: #ba2f59; font-weight: bold;">Container</span> <span style="color: #715ab1;">&#8592;</span> <span style="color: #ba2f59; font-weight: bold;">Set</span> &#8467;
                  insert    <span style="color: #715ab1;">&#8592;</span> (<span style="color: #ba2f59; font-weight: bold;">Elem</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Container</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Container</span>)
                  <span style="color: #715ab1;">&#8709;</span>         <span style="color: #715ab1;">&#8592;</span> <span style="color: #ba2f59; font-weight: bold;">Container</span>
                  <span style="color: #ba2f59; font-weight: bold;">End</span> {&#8467;}
</code></pre>
</div>

<div class="org-src-container">

<pre  class="fragment appear"><code trim><span style="color: #ba2f59; font-weight: bold;">&#8450;</span> <span style="color: #ba2f59; font-weight: bold;">:</span> <span style="color: #ba2f59; font-weight: bold;">Set</span> <span style="color: #715ab1;">&#8594;</span> <span style="color: #ba2f59; font-weight: bold;">Set</span>
<span style="color: #ba2f59; font-weight: bold;">&#8450;</span> <span style="color: #ba2f59; font-weight: bold;">Elem</span> <span style="color: #715ab1;">=</span> termtype ((<span style="color: #ba2f59; font-weight: bold;">Collection</span> &#8467;&#8320; <span style="color: #ba2f59; font-weight: bold;">:</span>waist 2) <span style="color: #ba2f59; font-weight: bold;">Elem</span>)
</code></pre>
</div>
<div class="org-src-container">

<pre  class="fragment appear"><code trim><span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">: X &#8594; &#8450; X &#8594; &#8450; X</span>
<span style="color: #3a81c3; font-weight: bold;">pattern</span> <span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #715ab1;">::</span><span style="color: #3a81c3; font-weight: bold;">_</span> x xs
         <span style="color: #715ab1;">=</span> &#956; (inj&#8321; (x , xs , tt))

<span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">: &#8450; X</span>
<span style="color: #3a81c3; font-weight: bold;">pattern</span>  <span style="color: #6c3163; font-weight: bold;">&#8709;</span>
    <span style="color: #715ab1;">=</span> &#956; (inj&#8322; (inj&#8321; tt))
</code></pre>
</div>

</section>
</section>
<section>
<section id="slide-org971d651">
<h3 id="org971d651"><a href="#org971d651">Summary</a></h3>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">‚Äòtheory‚Äô œÑ</th>
<th scope="col" class="org-left">‚Äòdata structure‚Äô <code>termtype œÑ</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">pointed set</td>
<td class="org-left">ùüô</td>
</tr>

<tr>
<td class="org-left">dynamic system</td>
<td class="org-left">‚Ñï</td>
</tr>

<tr>
<td class="org-left">monoid</td>
<td class="org-left">tree skeletons</td>
</tr>

<tr>
<td class="org-left">collections</td>
<td class="org-left">lists</td>
</tr>

<tr>
<td class="org-left">graphs</td>
<td class="org-left">(homogeneous) pairs</td>
</tr>

<tr>
<td class="org-left">actions</td>
<td class="org-left">infinite streams</td>
</tr>
</tbody>
</table>

<blockquote >
<p>
<i>Many more theories œÑ to explore and see what data structures arise!</i>
</p>
</blockquote>

</section>
</section>
<section>
<section id="slide-org75dc253">
<h2 id="org75dc253"><a href="#org75dc253">Bye!</a></h2>
<p>
<i>Thanks for listening in!</i>
</p>

<small>
<ul>
<li><p>
The <code class="src src-agda2"><span style="color: #ba2f59; font-weight: bold;">Context</span></code> Library:
</p>

<p>
<a href="https://alhassy.github.io/next-700-module-systems/diy/Context.agda">https://alhassy.github.io/next-700-module-systems/diy/Context.agda</a>
</p></li>

<li><p>
Examples to play with:
</p>

<p>
<a href="https://alhassy.github.io/next-700-module-systems/diy/Examples.agda">https://alhassy.github.io/next-700-module-systems/diy/Examples.agda</a>
</p></li>

<li>Project homepage: <a href="https://alhassy.github.io/next-700-module-systems/">https://alhassy.github.io/next-700-module-systems/</a></li>

</ul>

<p>
These slides:
</p>

<p>
<a href="https://alhassy.github.io/next-700-module-systems/diy/agda-implementors-meeting-2020">https://alhassy.github.io/next-700-module-systems/diy/agda-implementors-meeting-2020</a>
</p>
</small>
</section>
</section>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: '' // Location of socket.io server
},

// Optional libraries used to extend on reveal.js
dependencies: [
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }]
});
</script>
</body>
</html>
